{% extends "base.html" %}

{% block title %}My Tokens - Sonic's Risk Switch{% endblock %}
{% block tokens_active %}active{% endblock %}

{% block content %}
<!-- Tokens Table -->
<table class="table table-striped table-bordered mt-4" style="max-height: 500px; overflow-y: auto;">
    <thead class="bg-dark text-white">
        <tr>
            <th>Project</th>
            <th>% Holdings</th>
            <th>TVL (USD)</th>
            <th>Avg APY</th>
            <th>Security Score</th>
            <th>Risk</th>
            <th>Impermanent Loss</th>
            <th>Total Pools</th>
            <th>Hacks Reported</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% if message %}
            <tr>
                <td colspan="10">
                    No tokens to analyse. Native token is considered out of scope.
                </td>
            </tr>
        {% elif data|length == 0 %}
            <tr>
                <td colspan="10">
                    You have no tokens. If you want to analyze a specific token,
                    please visit the "Analyze Token" section.
                </td>
            </tr>
        {% else %}
            {% for token_symbol, token_info in data.items() %}
                {% if token_info.percentOfPortfolio|float > 0 %}
                <tr>
                    <!-- 1. Project -->
                    <td>{{ token_info.tokenSymbol }}</td>

                    <!-- 2. % Holdings -->
                    <td>{{ token_info.percentOfPortfolio }}%</td>

                    <!-- 3. TVL (USD) -->
                    <td>
                        {% if token_info.tvlMetrics.totalTvl != 'NA' %}
                            ${{ token_info.tvlMetrics.totalTvl }}
                        {% else %}
                            NA
                        {% endif %}
                    </td>

                    <!-- 4. Avg APY -->
                    <td>
                        {% if token_info.tvlMetrics.avgApy != 'NA' %}
                            {{ token_info.tvlMetrics.avgApy }}%
                        {% else %}
                            NA
                        {% endif %}
                    </td>

                    <!-- 5. Security Score -->
                    <td>
                        {% if token_info.auditSecurityScore.total_score != 0 %}
                            {{ token_info.auditSecurityScore.total_score }}
                        {% else %}
                            NA
                        {% endif %}
                    </td>

                    <!-- 6. Risk Classification (Based on predictedProbability) -->
                    <td>
                        {% set risk_value = token_info.tvlMetrics.predictedProbability if token_info.tvlMetrics.predictedProbability != 'NA' else 0 %}
                        {% if risk_value == 0 %}
                            <span class="badge bg-warning text-white">NA</span>
                        {% elif risk_value > 70 %}
                            <span class="badge bg-danger text-white">High</span>
                        {% elif risk_value > 50 %}
                            <span class="badge bg-warning text-dark">Medium</span>
                        {% else %}
                            <span class="badge bg-success">Low</span>
                        {% endif %}
                    </td>

                    <!-- 7. Impermanent Loss -->
                    <td>
                        {% if token_info.tvlMetrics.impermanentLossRisk != 'NA' and token_info.tvlMetrics.impermanentLossRisk > 0 %}
                            <span class="badge bg-danger text-white">Yes</span>
                        {% else %}
                            <span class="badge bg-success text-white">No</span>
                        {% endif %}
                    </td>

                    <!-- 8. Total Pools -->
                    <td>
                        {% if token_info.tvlMetrics.numPools != 'NA' %}
                            {{ token_info.tvlMetrics.numPools }}
                        {% else %}
                            NA
                        {% endif %}
                    </td>

                    <!-- 9. Hacks Reported -->
                    <td>
                        {% if token_info.pastHacks == "Yes" %}
                            <span class="badge bg-danger text-white">Yes</span>
                        {% elif token_info.pastHacks == "No" %}
                            <span class="badge bg-success text-white">No</span>
                        {% else %}
                            {% if token_info.pastHacks.slowmist is defined and token_info.pastHacks.slowmist.message == "No hacks found"
                               and token_info.pastHacks.rekt_news is defined and token_info.pastHacks.rekt_news.message == "No hacks found" %}
                                <span class="badge bg-success text-white">No</span>
                            {% else %}
                                <span class="badge bg-danger text-white">Yes</span>
                            {% endif %}
                        {% endif %}
                    </td>

                    <!-- 10. Action -->
                    <td>
                        <a class="btn btn-sm btn-dark">
                            ðŸ“„ View Report (Soon)
                        </a>
                    </td>
                </tr>
                {% endif %}
            {% endfor %}
        {% endif %}
    </tbody>
</table>
{% endblock %}
